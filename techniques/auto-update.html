<h1>Auto Updating Desktop Application</h1>
<p>Talk to any web developer and they&#8217;ll tell you how the web has simplified the deployment story. Truly, there is nothing simpler than copying your app over to the web server and the user doesn&#8217;t have to be involved in the upgrade process at all. On the other hand, the deployment and update stories for desktop applications is usually a little more involved for both the developer and the user. In the worst possible scenario, the user must first uninstall the existing app, then download an installer for the new version and install it manually. Slightly better is the installer that overwrites the previous install, thus removing one step in the upgrade for the user. And I think we can all agree that the best upgrade user experience is for the app to simply update itself in the background without the user knowing about it.</p>
<p>It&#8217;s with this in mind that I started writing a small desktop app that would update itself. I decided to start out very simply and let this thing evolve over time. For now, all I want to do is build a minimal app that can only do a very basic thing: check for a new version of the main <span class="caps">DLL</span> library, download it and run it. To get the ball rolling, I created a small Linode server that I&#8217;m using to store my app <span class="caps">DLL</span>. This server will also act as a <span class="caps">REST</span> server to query the version of the <span class="caps">DLL</span> and as a database server so I can compile some metrics, but at the moment, it&#8217;ll simply be used as a file server.</p>
<p>(show image with Linode server with overlaping cloud representing a Rest service that returns version of <span class="caps">DLL</span>. Show computer ask rest service for version and download dll)</p>
<p>The trick now is to have a deploy script that build the app and copies the <span class="caps">DLL</span> to Linode. By the way, I&#8217;ve been watching the most excellent videos series <a href="http://peepcode.com/products/play-by-play-bernhardt">Play by Play</a> on <a href="http://peepcode.com/">Peepcode</a> and I&#8217;ve learned in the latest installment that getting started on your deployment story early and evolving it as you go is better than doing it all at once at the end. This seemed like good advice to follow so I wrote a simple makefile (yes, I&#8217;m on Linux) that can easily build and deploy the <span class="caps">DLL</span>:</p>
<p>(show makefile image)</p>
<p>This makefile has three tasks:</p>
<ol>
	<li>build the app in debug mode using xbuild, the equivalent of msbuild on Mono</li>
	<li>build the app in release mode</li>
	<li>deploy the app</li>
</ol>
<p>The deploy task depends on the release task, which will execute first. Then the makefile will run the two scp commands. Scp is a command line utility that is used to copy files to servers via <span class="caps">SSH</span>. Normally, scp would prompt you for a user name and password, which is not something I want if I want to have an automated deploy story. So I set up a pair of <span class="caps">RSA</span> keys and copied my public key to the Linode server. Now executing the scp commands is seemless and my <span class="caps">DLL</span> is copied every single time I type in &#8220;make deploy&#8221; on the command line.</p>
<p>Now back in my main application code, all I need to do is to download the <span class="caps">DLL</span> and load it.</p>
<p>(show img of download code)</p>
<p>I&#8217;m using SharpSSH, a C# port of a Java library that abstracts <span class="caps">SSH</span> tasks, including file copying using the Scp class. This lets me download the <span class="caps">DLL</span> in exactly the same way I uploaded it, via a secured channel, to prevent man in the middle attacks.</p>
<p>(show img of dynamic code)</p>
<p>Finally, I load the <span class="caps">DLL</span> dynamically. This frees me from having to cast the object to a common interface. As long as my object responds to the ShowAll method, it&#8217;ll run. I&#8217;ve now got a basic skeleton of an auto updating app. The next step will be to increment a version number every time the <span class="caps">DLL</span> is deployed and to create a web service that can be used to query the deployed DLL&#8217;s version and only download it when necessary.</p>
